import{n as Y,f as B,k as Z,s as N,o as ee,p as te,q as se,c as oe,w as t,j as k,r as s,a as l,d as e,e as i,h as d,l as r,b as T,t as h,i as v,F as j,m as M,v as P,x as ae}from"./index-jdzLdHZF.js";const ne="http://localhost:5000/api/chat/",le=Y("chat",{state:()=>({messages:[],loading:!1}),actions:{async sendMessage(w,u){const _=B();this.loading=!0,this.messages.push({sender:"user",text:u});try{const c=await fetch(ne,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.token}`},body:JSON.stringify({studentId:w,message:u})});if(!c.ok)throw new Error("Failed to get AI response");const g=await c.json();this.messages.push({sender:"ai",text:g.reply})}catch(c){this.messages.push({sender:"system",text:"Error communicating with AI"}),console.error(c)}finally{this.loading=!1}},clearChat(){this.messages=[]}}}),re={key:0,class:"mt-4"},ie={key:0},ce={key:0,class:"text-center text-grey mt-10"},de={key:1,class:"text-center text-grey"},ue={key:0,class:"px-4 py-2"},pe={__name:"Dashboard",setup(w){const u=Z(),_=le(),c=B(),{pis:g}=N(u),{messages:y,loading:x}=N(_),n=k(null),m=k(""),p=k(null);ee(()=>{u.fetchPIs()}),te(y,async()=>{await se(),p.value&&(p.value.scrollTop=p.value.scrollHeight)},{deep:!0});const S=async()=>{if(!m.value.trim()||!n.value)return;const f=m.value;m.value="",await _.sendMessage(n.value._id,f)},Q=["Hazme un resumen del diagnóstico del alumno.","Qué debo tener en consideración al tratar con el alumno?","Qué metodologías se han usado con éxito anteriormente con este alumno?"],z=async f=>{n.value&&await _.sendMessage(n.value._id,f)},F=()=>{c.logout()};return(f,o)=>{const L=s("v-toolbar-title"),D=s("v-spacer"),E=s("v-btn"),U=s("v-toolbar"),C=s("v-card-title"),H=s("v-select"),I=s("v-card-text"),b=s("v-card"),A=s("v-col"),K=s("v-chip"),O=s("v-slide-group-item"),R=s("v-slide-group"),$=s("v-divider"),J=s("v-icon"),q=s("v-text-field"),G=s("v-card-actions"),W=s("v-row"),X=s("v-container");return l(),oe(X,{class:"fill-height"},{default:t(()=>[e(U,{flat:"",density:"compact"},{default:t(()=>[e(L,null,{default:t(()=>[...o[2]||(o[2]=[i("Master Dashboard",-1)])]),_:1}),e(D),e(E,{color:"red",onClick:F,size:"small"},{default:t(()=>[...o[3]||(o[3]=[i("Logout",-1)])]),_:1})]),_:1}),e(W,{class:"fill-height"},{default:t(()=>[e(A,{cols:"12",md:"4",class:"d-flex flex-column gap-3"},{default:t(()=>[e(b,{class:"mb-4"},{default:t(()=>[e(C,null,{default:t(()=>[...o[4]||(o[4]=[i("Context Setup",-1)])]),_:1}),e(I,null,{default:t(()=>[e(H,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=a=>n.value=a),items:d(g),"item-title":"studentName","item-value":"studentId",label:"Select Student (PI Context)",hint:"This loads the PI into the AI's context window","persistent-hint":"","return-object":""},null,8,["modelValue","items"]),n.value?(l(),r("div",re,[o[5]||(o[5]=T("strong",null,"Loaded Context:",-1)),i(" "+h(n.value.originalFileName),1)])):v("",!0)]),_:1})]),_:1})]),_:1}),e(A,{cols:"12",md:"8",class:"fill-height pb-10"},{default:t(()=>[e(b,{class:"fill-height d-flex flex-column"},{default:t(()=>[e(C,{class:"bg-grey-lighten-4"},{default:t(()=>[o[6]||(o[6]=i(" AI Assistant ",-1)),n.value?(l(),r("span",ie,"for "+h(n.value.studentName),1)):v("",!0)]),_:1}),e(I,{ref_key:"chatContainer",ref:p,class:"flex-grow-1 overflow-y-auto pa-4",style:{height:"400px","max-height":"60vh"}},{default:t(()=>[d(y).length===0?(l(),r("div",ce," Select a student and start asking questions. ")):v("",!0),(l(!0),r(j,null,M(d(y),(a,V)=>(l(),r("div",{key:V,class:P(["d-flex mb-4",a.sender==="user"?"justify-end":"justify-start"])},[e(b,{color:a.sender==="user"?"primary":"grey-lighten-3",variant:(a.sender==="user","flat"),class:"pa-3",style:{"max-width":"80%"}},{default:t(()=>[T("div",{class:P(a.sender==="user"?"text-white":"text-black")},h(a.text),3)]),_:2},1032,["color","variant"])],2))),128)),d(x)?(l(),r("div",de,"AI is thinking...")):v("",!0)]),_:1},512),n.value?(l(),r("div",ue,[e(R,{"show-arrows":""},{default:t(()=>[(l(),r(j,null,M(Q,a=>e(O,{key:a},{default:t(({isSelected:V,toggle:_e})=>[e(K,{class:"ma-1",color:"primary",variant:"outlined",onClick:me=>z(a),disabled:d(x)},{default:t(()=>[i(h(a),1)]),_:2},1032,["onClick","disabled"])]),_:2},1024)),64))]),_:1})])):v("",!0),e($),e(G,{class:"pa-4"},{default:t(()=>[e(q,{modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=a=>m.value=a),label:"Ask about teaching strategies...",variant:"outlined",density:"comfortable","hide-details":"",onKeyup:ae(S,["enter"]),disabled:!n.value||d(x)},{"append-inner":t(()=>[e(J,{onClick:S,color:"primary",class:"cursor-pointer"},{default:t(()=>[...o[7]||(o[7]=[i("mdi-send",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};export{pe as default};
